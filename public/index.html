<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grupo ST Comunicaçao Integrada</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <style>
    :root {
      --cor-fundo: #2c3e50;
      --cor-card: #34495e;
      --cor-borda: #46607a;
      --cor-texto: #ecf0f1;
      --cor-destaque: #3498db;
      --cor-sucesso: #2ecc71;
      --cor-aviso: #f1c40f;
      --cor-perigo: #e74c4c;
    }
    body {
      background-color: var(--cor-fundo);
      color: var(--cor-texto);
    }
    .card {
      background-color: var(--cor-card);
      border: 1px solid var(--cor-borda);
    }
    .card-title, .form-label, .table-dark thead th {
      color: var(--cor-texto) !important;
    }
    .form-control, .form-select {
      background-color: var(--cor-card);
      border: 1px solid var(--cor-borda);
      color: var(--cor-texto);
    }
    .form-control::placeholder {
      color: #bdc3c7;
    }
    .table-dark thead th {
      background-color: var(--cor-card);
      border-color: var(--cor-borda);
    }
    .table-dark tbody tr {
      border-color: var(--cor-borda);
    }
    .nav-tabs .nav-link {
      color: var(--cor-texto);
      border: 1px solid transparent;
      border-bottom: 1px solid var(--cor-borda);
      background-color: var(--cor-fundo);
    }
    .nav-tabs .nav-link.active {
      background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
      color: var(--cor-destaque);
      border-color: var(--cor-borda);
      border-bottom-color: transparent;
    }
    .btn-primary {
      background-color: var(--cor-destaque);
      border-color: var(--cor-destaque);
    }
    .btn-primary:hover {
      background-color: #2980b9;
      border-color: #2980b9;
    }
    .concluida {
      text-decoration: line-through;
      color: #95a5a6 !important;
    }
    .badge-prioridade-baixa { background-color: var(--cor-sucesso); }
    .badge-prioridade-media { background-color: var(--cor-aviso); color: #000; }
    .badge-prioridade-alta { background-color: var(--cor-perigo); }
    .navbar {
      background-color: var(--cor-card);
      border-bottom: 1px solid var(--cor-borda);
    }
    .navbar-brand {
      color: var(--cor-texto) !important;
    }
    .btn-outline-secondary {
      color: var(--cor-texto);
      border-color: var(--cor-borda);
    }
    .btn-outline-danger {
      color: var(--cor-perigo);
      border-color: var(--cor-perigo);
    }
    .btn-outline-success {
      color: var(--cor-sucesso);
      border-color: var(--cor-sucesso);
    }
    #userIdDisplay {
        font-size: 0.8rem;
        color: #7f8c8d;
        word-break: break-all;
    }
    .text-center-btn {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
        margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  
  <div class="container mt-4">
    <div class="card p-4">
      <div class="d-flex justify-content-center align-items-center mb-4">
        <img src="/images/image_64f7fe.png" alt="Logo da Empresa" style="max-height: 120px;">
      </div>
      <h1 class="card-title text-center p-3">Grupo ST Comunicaçao Integrada</h1>
      <div class="text-end mb-3">
        <button onclick="logout()" class="btn btn-outline-danger btn-sm">Sair</button>
      </div>

      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="objetivos-tab" data-bs-toggle="tab" href="#objetivos" role="tab" aria-controls="objetivos" aria-selected="true">Objetivos</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="liberacoes-tab" data-bs-toggle="tab" href="#liberacoes" role="tab" aria-controls="liberacoes" aria-selected="false">Liberações de O.S</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="pcp-tab" data-bs-toggle="tab" href="#pcp" role="tab" aria-controls="pcp" aria-selected="false">PCP</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="producao-tab" data-bs-toggle="tab" href="#producao" role="tab" aria-controls="producao" aria-selected="false">Produção</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="almoxarifado-tab" data-bs-toggle="tab" href="#almoxarifado" role="tab" aria-controls="almoxarifado" aria-selected="false">Almoxarifado</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="expedicao-tab" data-bs-toggle="tab" href="#expedicao" role="tab" aria-controls="expedicao" aria-selected="false">Expedição</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="requisicoes-tab" data-bs-toggle="tab" href="#requisicoes" role="tab" aria-controls="requisicoes" aria-selected="false">Requisições de Materiais</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="graficos-tab" data-bs-toggle="tab" href="#graficos" role="tab" aria-controls="graficos" aria-selected="false">Gráficos</a>
        </li>
      </ul>

      <div class="tab-content mt-3" id="myTabContent">
        <div class="tab-pane fade show active" id="objetivos" role="tabpanel" aria-labelledby="objetivos-tab">
            <h5 class="text-white">Registro de Prioridades e Objetivos</h5>
            <form id="prioridadeForm">
                <div class="mb-3">
                    <label for="tipoPrioridade" class="form-label">Tipo de Prioridade</label>
                    <select class="form-select" id="tipoPrioridade" required>
                        <option value="">Selecione...</option>
                        <option value="os">Prioridade O.S.</option>
                        <option value="producao">Prioridade Produção</option>
                    </select>
                </div>

                <div id="osFields" style="display: none;">
                    <div class="mb-3">
                        <label for="osNumber" class="form-label">Número da O.S.</label>
                        <input type="text" class="form-control" id="osNumber">
                    </div>
                    <div class="mb-3">
                        <label for="clientName" class="form-label">Nome do Cliente</label>
                        <input type="text" class="form-control" id="clientName">
                    </div>
                </div>

                <div id="producaoFields" style="display: none;">
                    <div class="mb-3">
                        <label for="involvedSectors" class="form-label">Setores Envolvidos</label>
                        <input type="text" class="form-control" id="involvedSectors">
                    </div>
                    <div class="mb-3">
                        <label for="priorityOrders" class="form-label">Pedidos em Prioridade</label>
                        <textarea class="form-control" id="priorityOrders" rows="3"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100">Salvar Prioridade</button>
            </form>
            <div id="statusMessage" class="mt-3 text-center"></div>
        </div>
        <div class="tab-pane fade" id="liberacoes" role="tabpanel" aria-labelledby="liberacoes-tab">
            <h5 class="text-white">Conteúdo do Módulo de Liberações de O.S.</h5>
            <p>Gerenciamento e liberação de ordens de serviço.</p>
        </div>
        <div class="tab-pane fade" id="pcp" role="tabpanel" aria-labelledby="pcp-tab">
            <h5 class="text-white">Conteúdo do Módulo de PCP</h5>
            <p>Planejamento e controle da produção.</p>
        </div>
        <div class="tab-pane fade" id="producao" role="tabpanel" aria-labelledby="producao-tab">
            <h5 class="text-white">Conteúdo do Módulo de Produção</h5>
            <p>Acompanhamento da produção em tempo real.</p>
        </div>
        <div class="tab-pane fade" id="almoxarifado" role="tabpanel" aria-labelledby="almoxarifado-tab">
            <h5 class="text-white">Conteúdo do Módulo de Almoxarifado</h5>
            <p>Gerenciamento de estoque e materiais.</p>
        </div>
        <div class="tab-pane fade" id="expedicao" role="tabpanel" aria-labelledby="expedicao-tab">
            <h5 class="text-white">Conteúdo do Módulo de Expedição</h5>
            <p>Acompanhamento dos pedidos para envio.</p>
        </div>
        <div class="tab-pane fade" id="requisicoes" role="tabpanel" aria-labelledby="requisicoes-tab">
            <h5 class="text-white">Conteúdo do Módulo de Requisições de Materiais</h5>
            <p>Área para solicitar materiais ao almoxarifado.</p>
        </div>
        <div class="tab-pane fade" id="graficos" role="tabpanel" aria-labelledby="graficos-tab">
            <h5 class="text-white">Conteúdo do Módulo de Gráficos</h5>
            <p>Visualização de dados e performance.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, setDoc, onSnapshot, query, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const auth = getAuth(initializeApp(firebaseConfig));
    const db = getFirestore(auth.app);
    let userId;

    document.addEventListener('DOMContentLoaded', async () => {
        const userRole = sessionStorage.getItem('userRole');
        if (!userRole || userRole !== 'adm123') {
            window.location.href = 'login.html';
            return;
        }

        if (typeof __initial_auth_token !== 'undefined') {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
        
        userId = auth.currentUser?.uid || crypto.randomUUID();

        const prioridadeSelect = document.getElementById('tipoPrioridade');
        const osFields = document.getElementById('osFields');
        const producaoFields = document.getElementById('producaoFields');
        const prioridadeForm = document.getElementById('prioridadeForm');
        const statusMessage = document.getElementById('statusMessage');

        prioridadeSelect.addEventListener('change', (e) => {
            if (e.target.value === 'os') {
                osFields.style.display = 'block';
                producaoFields.style.display = 'none';
            } else if (e.target.value === 'producao') {
                producaoFields.style.display = 'block';
                osFields.style.display = 'none';
            } else {
                osFields.style.display = 'none';
                producaoFields.style.display = 'none';
            }
        });

        prioridadeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const tipo = prioridadeSelect.value;
            let data = { tipo: tipo, timestamp: new Date() };

            if (tipo === 'os') {
                data.numeroOS = document.getElementById('osNumber').value;
                data.nomeCliente = document.getElementById('clientName').value;
            } else if (tipo === 'producao') {
                data.setoresEnvolvidos = document.getElementById('involvedSectors').value;
                data.pedidosPrioridade = document.getElementById('priorityOrders').value;
            }

            try {
                // Salva o documento na coleção pública para que todos vejam
                await addDoc(collection(db, `artifacts/${appId}/public/data/prioridades`), data);
                statusMessage.textContent = 'Prioridade salva com sucesso!';
                statusMessage.style.color = 'var(--cor-sucesso)';
                prioridadeForm.reset();
                osFields.style.display = 'none';
                producaoFields.style.display = 'none';
            } catch (error) {
                console.error("Erro ao salvar documento:", error);
                statusMessage.textContent = 'Erro ao salvar prioridade. Tente novamente.';
                statusMessage.style.color = 'var(--cor-perigo)';
            }
        });
    });

    function logout() {
        sessionStorage.removeItem('userRole');
        window.location.href = 'login.html';
    }
  </script>
</body>
</html>
